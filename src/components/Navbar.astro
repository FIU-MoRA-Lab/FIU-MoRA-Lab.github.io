---
import { readdirSync } from 'fs';
import { join } from 'path';

// Dynamically generate links from pages directory
const pagesDir = join(process.cwd(), 'src/pages');
const pageFiles = readdirSync(pagesDir, { withFileTypes: true });

const links = pageFiles
    .filter(file => file.isFile() && file.name.endsWith('.astro'))
    .map(file => {
        const name = file.name.replace('.astro', '');
        const href = name === 'index' ? '/' : `${name}`;
        const label = name === 'index' 
            ? 'Home' 
            : name.charAt(0).toUpperCase() + name.slice(1);
        return { href, label };
    })
    .filter(link => link.label !== 'Home') // Remove Home from navigation
    .concat({ href: '/blog', label: 'Blog' })
    .sort((a, b) => a.label.localeCompare(b.label)); // Alphabetical order

import ThemeToggle from "./ThemeToggle.astro";
import Logo from "./Logo.astro";

const currentPath = Astro.url.pathname;
const isIndexPage = currentPath === '/' || currentPath === '';
---

<nav class="w-full py-6 md:py-8 lg:py-12 bg-transparent">
    <div class="container mx-auto px-4 max-w-6xl">
        <!-- Main Navbar Container -->
        <div class="flex flex-col lg:flex-row justify-between items-center lg:items-center gap-6 lg:gap-0">
            <!-- Mobile Header: Logo + Hamburger -->
            <div class="w-full md:w-auto flex justify-between items-center">
                <Logo forceTheme={isIndexPage ? 'dark' : undefined} />
                
                <!-- Hamburger Button -->
                <button 
                    id="menu-toggle" 
                    class:list={[
                        "md:hidden focus:outline-none",
                        isIndexPage ? "text-gray-200" : "text-gray-800 dark:text-gray-200"
                    ]}
                    aria-label="Toggle Navigation"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>

            <!-- Right Side: Navigation + Toggle -->
            <div 
                id="menu-content" 
                class="hidden md:flex flex-col md:flex-row items-center gap-6 md:gap-8 lg:gap-12 w-full md:w-auto"
            >
                <!-- Navigation Links -->
                <ul class="flex flex-col md:flex-row flex-wrap lg:flex-nowrap justify-center lg:justify-start gap-4 md:gap-6 lg:gap-12 items-center w-full md:w-auto">
                    {
                    links.map((link) => {
                        const isActive =
                            currentPath === link.href ||
                            (link.href !== "/" &&
                                currentPath.startsWith(link.href));
                        return (
                            <li>
                                <a
                                    href={link.href}
                                    class="relative group grid items-center justify-items-center"
                                >
                                    <!-- Reserved Spacer (Boldest State) -->
                                    <span
                                        aria-hidden="true"
                                        class="col-start-1 row-start-1 font-bold opacity-0 invisible text-xs md:text-sm uppercase tracking-wide md:tracking-widest"
                                    >
                                        {link.label}
                                    </span>

                                    <!-- Visible Text -->
                                    <span
                                        class:list={[
                                            "col-start-1 row-start-1 text-xs md:text-sm uppercase tracking-wide md:tracking-widest transition-[font-variation-settings,color] duration-300",
                                            isActive
                                                ? // Active state
                                                  isIndexPage
                                                    ? "text-white [font-variation-settings:'wght'_700]"
                                                    : "text-black dark:text-white [font-variation-settings:'wght'_700]"
                                                : // Inactive state
                                                  isIndexPage
                                                  ? "text-gray-200 [font-variation-settings:'wght'_400] group-hover:[font-variation-settings:'wght'_700] group-hover:text-[var(--color-highlight)]"
                                                  : "text-gray-800 dark:text-gray-200 [font-variation-settings:'wght'_400] group-hover:[font-variation-settings:'wght'_700] group-hover:text-[var(--color-highlight)] dark:group-hover:text-[var(--color-highlight)]",
                                        ]}
                                    >
                                        {link.label}
                                    </span>
                                </a>
                            </li>
                        );
                    })
                }
            </ul>
            
            
            <!-- Theme Toggle -->
            {!isIndexPage && <ThemeToggle />}
        </div>
    </div>

</nav>

<script>
    document.addEventListener('astro:page-load', () => {
        const menuToggle = document.getElementById("menu-toggle");
        const menuContent = document.getElementById("menu-content");

        if (menuToggle && menuContent) {
            menuToggle.addEventListener("click", () => {
                menuContent.classList.toggle("hidden");
                menuContent.classList.toggle("flex");
            });
        }
    });
</script>

<!-- Google Fonts: Roboto Flex Variable Font with width variations -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:wght@100..1000;wdth@25..151&display=swap" rel="stylesheet">
