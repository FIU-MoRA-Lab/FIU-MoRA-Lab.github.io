---
import BioModal from "./BioModal.astro";
import type { CollectionEntry } from "astro:content";

interface Props {
    person: CollectionEntry<"team">["data"];
}

const { person } = Astro.props;
const modalId = `modal-${person.name.toLowerCase().replace(/\s+/g, "-")}`;
---

<div
    class="group relative w-full aspect-square bg-transparent overflow-hidden border border-gray-200 dark:border-[#333] transition-colors duration-300"
    style="container-type: inline-size;"
>
    <!-- Full Card Click Trigger -->
    <button
        onclick={`document.getElementById('${modalId}').showModal()`}
        class="absolute inset-0 z-10 w-full h-full cursor-pointer focus:outline-none"
        aria-label={`View bio for ${person.name}`}></button>

    <!-- 
        Image Container 
        Top Right, Flush (no padding).
    -->
    <div
        class="absolute top-0 right-0 z-0 pointer-events-none"
        style="width: 55cqi; height: 55cqi;"
    >
        <div class="relative w-full h-full overflow-hidden">
            <img
                src={person.image}
                alt={person.name}
                class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500"
                loading="lazy"
            />
            <!-- 
                Swipe Bar Animation 
                Appears at the bottom of the IMAGE.
            -->
            <div
                class="absolute bottom-0 left-0 w-full h-[3px] bg-[var(--color-highlight)] transform -translate-x-full group-hover:translate-x-0 transition-transform duration-500 ease-out z-20"
            >
            </div>
        </div>
    </div>

    <!-- 
        Bottom Left Info 
        Fixed position regardless of content interaction.
        z-20 to sit above the click trigger, allowing links to be clickable.
        pointer-events-none allows clicks on non-interactive parts (like the name space) to pass through to the button.
    -->
    <div
        class="absolute z-20 w-full pointer-events-none"
        style="bottom: 0; left: 0; padding: 7cqi;"
    >
        <div class="flex flex-col w-full">
            <!-- Header Info -->
            <div class="mb-[3cqi]">
                <h3
                    class="text-gray-900 dark:text-white flex items-baseline justify-between w-full"
                    style="font-size: 7cqi; line-height: 1.1;"
                >
                    <span
                        class="transition-[font-variation-settings,color] duration-300 [font-variation-settings:'wght'_400] group-hover:[font-variation-settings:'wght'_700] group-hover:text-[var(--color-highlight)]"
                    >
                        {person.name}
                    </span>
                    <span
                        class="opacity-0 group-hover:opacity-100 transition-opacity duration-300 italic font-normal text-[var(--color-highlight)] font-serif whitespace-nowrap shrink-0 ml-2"
                        style="font-size: 6cqi;"
                    >
                        About &rarr;
                    </span>
                </h3>
                {
                    person.title && (
                        <p
                            class="text-gray-600 dark:text-gray-400 uppercase tracking-wide mt-[1cqi]"
                            style="font-size: 4.5cqi;"
                        >
                            {person.title}
                        </p>
                    )
                }
            </div>

            <!-- Links -->
            <div
                class="flex flex-wrap gap-[1.5cqi] pointer-events-auto"
                style="font-size: 5.0cqi;"
            >
                {
                    person.links.map((link: { label: string; url: string }) => (
                        <a
                            href={link.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white underline decoration-1 underline-offset-4 transition-colors relative z-30"
                        >
                            [{link.label}]
                        </a>
                    ))
                }
            </div>
        </div>
    </div>
</div>

<BioModal person={person} id={modalId} />
