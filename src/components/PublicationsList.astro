---
import PublicationItem from "./PublicationItem.astro";
import type { Publication } from "../utils/publications";

interface Props {
    publications: Publication[];
    highlightAuthor?: string;
}

const { publications, highlightAuthor } = Astro.props;

// Group by year
const publicationsByYear = publications.reduce(
    (acc, pub) => {
        const year = pub.year;
        if (!acc[year]) acc[year] = [];
        acc[year].push(pub);
        return acc;
    },
    {} as Record<string, typeof publications>,
);

const years = Object.keys(publicationsByYear).sort(
    (a, b) => parseInt(b) - parseInt(a),
);
---

<div class="space-y-12">
    {
        years.length === 0 ? (
            <p class="text-gray-500">No publications found.</p>
        ) : (
            years.map((year) => (
                <div class="mb-8 md:mb-10 year-section" data-year={year}>
                    <h2 class="text-2xl md:text-3xl font-serif font-mono text-black border-b border-gray-300 dark:border-neutral-700 pb-2 mb-3 md:mb-4 dark:text-white">
                        {year}
                    </h2>
                    <div class="space-y-4 md:space-y-6">
                        {publicationsByYear[year].map((pub) => (
                            <PublicationItem
                                publication={pub}
                                highlightAuthor={highlightAuthor}
                            />
                        ))}
                    </div>
                </div>
            ))
        )
    }
</div>
